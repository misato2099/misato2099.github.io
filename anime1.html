<!DOCTYPE html>
<html>
    <head>
        <title>Canvas Animation Sample 1</title>
        <style>
            body{
                background-color: gray;
            };
        </style>
    </head>
    <body>
        <h2 title="press and hold the mouse to shoot">Canvas Animation Sample 1</h2>
        <script src = "https://code.jquery.com/jquery-3.6.3.js"></script>
        <canvas id="canvas" width="1700" height="500"></canvas>
        <script>
            // Step 0: create canvas object and trigger
            const canvas = document.getElementById("canvas"); 
            const ctx = canvas.getContext("2d"); 

            //Step 1: Draw a gun
            ctx.strokeStyle = "Black";
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.arc(127, 310, 20, 96, Math.PI, false);
            ctx.moveTo(150, 285);
            ctx.lineTo(300, 285);
            ctx.moveTo(150, 295);
            ctx.lineTo(300, 295);
            ctx.moveTo(150, 305);
            ctx.lineTo(300, 305);
            ctx.moveTo(150, 315);
            ctx.lineTo(300, 315);
            ctx.moveTo(280, 285);
            ctx.lineTo(280, 315);
            ctx.stroke();
            ctx.strokeRect(0,250, 150, 100);
            ctx.strokeRect(15,260, 70, 80);
            ctx.strokeRect(35, 285, 30, 30);
            ctx.strokeRect(100, 310, 30, 30);

            //Step 2-1: Create trigger
            let shoot = false;
            const pressTrigger = $("#canvas").mousedown(function (event) {
                shoot = true;
            });
            //Step 2-2: Create trigger condition
            const shooting = $("#canvas").mousedown(function (event) {
            if (shoot === true) {
            //Step 2-3: Setting parameters of animation
                var a = 350;
                var b = 350;
                var c = 350;
                var d = 350;
                var e = 350;
                var f = 295;
                var g = 295;
                var h = 295;
                var i = 295;
            //Step 2-3-1: Drawing bullet track
                let fireA = setInterval(function () {
                    ctx.clearRect(311, 0, 1700, 1000); 
                    ctx.fillStyle = "Red";
                    ctx.fillRect(a, h, 20, 5);
                    a += Math.random() * 10;
                    if (a > 1700) {
                        a = 350;
                    }
                    h += Math.random() - 2;
                    if (h > 335) {
                        h = 295;
                    }
                }, 1);
                let fireB = setInterval(function () {
                    ctx.clearRect(311, 0, 1700, 1000); 
                    ctx.fillStyle = "Gold";
                    ctx.fillRect(b, 295, 20, 5);
                    b += Math.random() * 35;
                    if (b > 1700) {
                        b = 350;
                    }
                }, 1);
                let fireC = setInterval(function () {
                    ctx.clearRect(311, 0, 1700, 1000); 
                    ctx.fillStyle = "Yellow";
                    ctx.fillRect(c, i, 20, 5);
                    c += Math.random() * 20;
                    if (c > 1700) {
                        c = 350;
                    }
                    i += Math.random() * 1.5 - 3;
                    if (i < 260) {
                        i = 295;
                    }
                }, 1);
                let fireD = setInterval(function () {
                    ctx.clearRect(311, 0, 1700, 1000); 
                    ctx.fillStyle = "White";
                    ctx.fillRect(d, f, 20, 5);
                    d += Math.random() * 40;
                    if (d > 1700) {
                        d = 350;
                    }
                    f += Math.random() * 1.6 - 3.1;
                    if (f > 360) {
                        f = 295;
                    }
                }, 1);
                let fireE = setInterval(function () {
                    ctx.clearRect(311, 0, 1700, 1000); 
                    ctx.fillStyle = "Orange";
                    ctx.fillRect(e, g, 20, 5);
                    e += Math.random() * 25;
                    if (e > 1700) {
                        e = 350;
                    }
                    g += Math.random() * 2 - 4;
                    if (g < 240) {
                        g = 295;
                    }
                }, 1);
                //Step 2-3-2: Drawing muzzle flash of shoot
                let flash = setInterval(function () {
                    ctx.clearRect(311, 0, 1700, 1000); //清除前面畫面圖像
                    ctx.strokeStyle = "Orange";
                    ctx.beginPath();
                    ctx.moveTo(311, 270);
                    ctx.lineTo(361, 260);
                    ctx.lineTo(321, 280);
                    ctx.lineTo(371, 285);
                    ctx.lineTo(330, 295);
                    ctx.lineTo(375, 305);
                    ctx.lineTo(340, 310);
                    ctx.lineTo(380, 320);
                    ctx.lineTo(340, 325);
                    ctx.lineTo(380, 340);
                    ctx.lineTo(315, 330);
                    ctx.stroke();
                },1);

                //Step 3: Create stop condition
                const releaseTrigger = $("#canvas").mouseup(function (event) {
                    clearInterval(fireA);
                    clearInterval(fireB);
                    clearInterval(fireC);
                    clearInterval(fireD);
                    clearInterval(fireE);
                    clearInterval(flash);
                    shoot = false;
                    ctx.clearRect(311, 0, 1700, 1000);
                });
                };
            });
        </script>
    </body>
</html>
